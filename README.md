# Survey Chat Bot

Чат-бот для проведения социологических опросов с использованием OpenAI API и естественного языка.

## Описание

Этот проект представляет собой веб-приложение для проведения интерактивных социологических опросов. Пользователи могут отвечать на вопросы своими словами, а система автоматически сопоставляет их ответы с предопределенными вариантами.

## Возможности

### Для пользователей
- Чат-интерфейс для прохождения опроса
- Понимание естественного языка (можно отвечать "25 лет" вместо точного варианта)
- Поддержка числовых ответов (1, 2, 3, "первое", "второе")
- Автоматическое сохранение ответов
- Возможность пройти опрос повторно

### Для администраторов
- Веб-панель администратора с авторизацией
- Просмотр статистики опросов в реальном времени
- Детальный анализ всех ответов пользователей
- Экспорт данных в CSV и JSON форматах
- Управление вопросами опроса
- Загрузка новых опросов через JSON

## Технологии

- **Backend**: Python, FastAPI
- **Frontend**: React, Vite
- **AI**: OpenAI GPT-4o-mini для понимания естественного языка
- **Роутинг**: React Router для навигации

## Установка

### Требования
- Python 3.8+
- Node.js 16+
- OpenAI API ключ

### Backend
```bash
cd backend
python -m venv .venv
source .venv/bin/activate  # На Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

### Frontend
```bash
cd frontend
npm install
```

## Настройка

### Переменные окружения
Создайте файл `backend/.env`:
```
OPENAI_API_KEY=your_openai_api_key_here
ADMIN_TOKEN=admin123
```

### Вопросы опроса
Отредактируйте файл `backend/survey_questions.json` для изменения вопросов.

## Запуск

### Backend
```bash
cd backend
source .venv/bin/activate
python3 main.py
```

### Frontend
```bash
cd frontend
npm run dev
```

Приложение будет доступно http://localhost:3000

## Использование

### Прохождение опроса
1. Откройте http://localhost:3000
2. Нажмите "Начать опрос"
3. Отвечайте на вопросы своими словами
4. Система автоматически сопоставит ваши ответы с вариантами

### Админ панель
1. Перейдите на http://localhost:3000/admin
2. Войдите с данными: admin / admin123
3. Просматривайте статистику и ответы пользователей
4. Экспортируйте данные в нужном формате

## Структура проекта

```
survey-chat/
├── backend/
│   ├── main.py                 # Основной API сервер
│   ├── survey_questions.json   # Вопросы опроса
│   ├── requirements.txt        # Python зависимости
│   ├── .env                    # переменные окружения
│   └── results/                # сохраненные результаты
├── frontend/
│   ├── src/
│   │   ├── App.jsx            # роутинг
│   │   ├── HomePage.jsx      
│   │   ├── ChatPage.jsx       
│   │   ├── AdminPanel.jsx     # Админ панель
│   │   └── *.css              # стили
│   ├── package.json           
│   └── vite.config.js         
└── README.md                  
```

## API Endpoints

### Публичные
- `POST /chat/start` - Начать новую сессию опроса
- `POST /chat/start/{session_id}` - Продолжить существующую сессию
- `POST /chat/message` - Отправить ответ пользователя
- `GET /survey/questions` - Получить все вопросы опроса

### Админ (требует авторизации)
- `POST /admin/login` - Авторизация администратора
- `GET /admin/stats` - Статистика опросов
- `GET /admin/responses` - Все ответы пользователей
- `GET /admin/export/csv` - Экспорт в CSV
- `GET /admin/export/json` - Экспорт в JSON
- `POST /admin/survey/upload` - Загрузить новый опрос
- `GET /admin/survey/current` - Получить текущий опрос

## Формат вопросов

```json
[
  {
    "id": 1,
    "question": "Сколько вам лет?",
    "type": "single_choice",
    "options": [
      {"code": "A1", "text": "Меньше 18"},
      {"code": "A2", "text": "18-24"},
      {"code": "A3", "text": "25-34"}
    ]
  }
]
```

### Типы вопросов
- `single_choice` - выбор одного варианта
- `multiple_choice` - выбор нескольких вариантов

## Особенности понимания ответов

Система понимает различные форматы ответов:

### Числовые ответы
- `1`, `2`, `3` - выбор по номеру
- `1)`, `2)`, `3)` - выбор с скобкой
- `первое`, `второе`, `третий` - порядковые числительные
- `последнее` - выбор последнего варианта

### Множественный выбор
- `1,2,3` - несколько номеров через запятую
- `первое и второе` - комбинация порядковых числительных
- `1 и 2` - номера с союзом "и"

### Естественный язык
- `25 лет` вместо точного варианта "25-34"
- `2 часа в день` вместо "5-10 часов в неделю"
- Синонимы и похожие фразы

## Экспорт данных

### CSV формат
Содержит плоскую структуру с колонками:
- session_id, timestamp, question_id, question
- answer_codes, answer_texts, original_answer

### JSON формат
Содержит полную структуру данных:
- Информация о сессии
- Все ответы с кодами и текстами
- Статус завершения опроса

## Безопасность

- Простая авторизация для админ панели
- Токен-защита API endpoints
- Валидация входных данных
- Защита от SQL-инъекций (используется JSON файлы)

## Разработка

### Добавление новых вопросов
1. Отредактируйте `backend/survey_questions.json`
2. Перезапустите backend
3. Новые вопросы появятся в опросе



